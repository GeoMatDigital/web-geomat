language: node_js
node_js:
- lts/*
cache:
  yarn: true
  directories:
  - node_modules
env:
  secure: MbvrtCwyergj7rmh4bIdEt6gOqVXEwY9PKmC+B6nlnuehL6iy6f6qot7oe3MHpadFDA+GtqSqOb9m8ibTIxi9Y43kslFJZYt6SReQsUUu1MREI0iE9yOGDslFKf+/gu2xCUMQl8KzqgGfd5FaytHe++CelC45NbuU13mfTi2NBwiMmFdLk2PrqwhJ9oGa3KIUBmmBENi8oFti53/zWnQZkf7PfzbfK6NcBHl4EitIVAGBcesjanGMsnDNSNlawmmpLnLfRs7xCKf0zG637OzBSZoWeDSo3ugV86fA4Q163wMOdGEorzkb0tniLl7dpZOlZd4UPduhYeIp/51zoMRBB9dEZt7K82NsOJmkTwlNsEHZb/cZfZQ7tIP6m2pbIHaKZwMRJPqC6rbSLRCXcgNIIBfr3rihAq0slZt0/wer0AzK47lpRNKClxXJ1IlGNF7xptIqiwMbViuAN7wR/XtB886hq9nKEJljzpeEOv/nDzgcZhvreIHJGFM/4LYE3b84JWHbzpYCO1srbUF9WV1DBfIOrDjCQgpJ2igrdpmWqRZF7D6PH/mKdA+nVq2/Rkz4c95CETcQzznYfVOrNZoLbdTqVy6+uD9wn3ybD9cEGpIe9XoQrvxCibxd3XSKd34mmHcvu76X7tyJKZJ2k0uIi3d60ExA+ciIQgfaVFkBbo=
stages:
- name: lint
- build
- name: deploy
  if: branch IN (master, dev) AND type != pull_request
jobs:
  include:
  - stage: lint
    script: yarn lint
  - stage: build
    script: "./.travis/build.sh ${TRAVIS_BRANCH}"
  - stage: deploy
    script: "./.travis/deploy.sh ${TRAVIS_PULL_REQUEST} ${TRAVIS_BRANCH}"
notifications:
  email:
    on_failure: change
on_success: change
before_install:
- chmod +x .travis/build.sh
- chmod +x .travis/deploy.sh
- openssl aes-256-cbc -K $encrypted_172b5ce8d004_key -iv $encrypted_172b5ce8d004_iv
  -in .travis/deploy.key.enc -out .travis/deploy.key -d
- eval "$(ssh-agent -s)"
- chmod 600 .travis/deploy.key
- ssh-add .travis/deploy.key
- ssh-keyscan $SERVER >> ~/.ssh/known_hosts
- |
  if [[ ${TRAVIS_PULL_REQUEST} == "false" ]] && [[ ${TRAVIS_BRANCH} == "dev" ]]; then
    git remote add deploy $USER@$SERVER:$STAGING_DIRECTORY
  fi
- |
  if [[ ${TRAVIS_PULL_REQUEST} == "false" ]] && [[ ${TRAVIS_BRANCH} == "master" ]]; then
    git remote add deploy $USER@$SERVER:$PRODUCTION_DIRECTORY
  fi
- git config --global push.default simple
N
